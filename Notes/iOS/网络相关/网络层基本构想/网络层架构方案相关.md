#网络架构方案

##底层网络请求

###基本请求Manager
基于AF3.0封装的底层类，所有请求都有这个这个类，职责负责全部的请求。AF只封装在该层，方便之后的替换。主要可以调用方法：1.发送请求。2.取消请求。3.发送请求组。由API与API组调用。所以内部的方法由（1.API转AFHTTPSessionManager  2.通过API请求。3.通过API删除。 其他暂定）
###config
manager持有的基本配置。由于Manager是单例，所以基本配置可以在delegate里创建完配置好，可配置基本url userAgent等。其他配置可以再议
###安全处理相关
####加密解密
一些基本的加解密方法以及一些基本的编码转化。有点像工具类，提供基本方法。（待补充）
####自定义签名
和后台约定的一种签名方式，待定，目的1.为了安全2.为了识别是否为APP发起，防止接口数据被盗用等。（待补充）
####SLL Pinning证书校验。
其实前面两种是偏向老的安全处理。现阶段如果已经使用Https了，就可以不使用之前的方式只要通过这个校验基本就能保证其是安全的。
###BaseAPI
网络请求的基本API，通过API 调用Manager 发起请求。里面有所有的请求所需要的参数与回调。主要方法，开始请求，结束请求。内部有通过API生成hash的方法。可以有hash判读是是不是同一个请求。
###BatchAPI 
提供多请求接口，原因，多请求可公用AFHTTPSessionManager减少套接字，提高请求效率。
###xxxAPI  
继承baseAPI，可以做一些特殊的处理，可以增加数据层解析json 转model 由使用者自己定义。
###相关思考
首先为什么使用传入一个BaseAPI做请求而不是一个个的字符，原因是可以把配置项移除col层，使col更清晰，还有这样做有利于做取消处理。当然请求的扩展也更容易实现。
关于数据回调，主要block，其他方式看具体场景，原因可以大大降低阅读成本，保证可维护性，当然要谨防内存泄露。
数据转换：网络层不做数据转换，给你的是最原始的数据。
####关于缓存：
网路请求基本不需要缓存，需要缓存的是图片等。这类缓存有其他第三方，大数据缓存由数据库等实现，这里不做考虑。
##关于网络环境监测
对比了之前的网络环境监测与AFNetworking上的网络监测，发现原来之前项目里的网络监测实则AFNetworking代码拷贝扩展了2G3G4G监测，现阶段是否需要这类网络的监测（个人认为2G基本被淘汰的情况下不需要了）主要是判断是否在WiFi环境（在上传视频，视频见证时候提示流量）
还有看了下还有个主要用途为在展示请求失败时候页面会先判断网路是否正常已显示不一样的文案，网络环境监测全程打开并未关闭。其原理主要为基于SCNetworkReachability 分装，主要把 SCNetworkReachabilityRef 放入runloop中监测如果环境改变调用方法（block与通知）同时在开始先异步监测一次网络环境(也会返回调用)。
基于这些，我感觉可能不需要再自己分装网络环境监测，可以直接用AFNetWorking的，至于需不需一直开启网络监测，可能还是需要的。


