## APP开发之网络基础



综述

### 应用层http

### 传输层TCP

### 网络层 IP

###  https

#### 1.https中的s是什么,为什么需要s

其实https中的s表示在http的基础上，添加了SSL/TLS握手以及数据加密传输。SSL其实是安全套接层(secure sockets layer)，而TLS是SSL的继任者，叫传输层安全（transport layer security)。

![http与https的区别](/Users/tang/Desktop/ReadingNotes/image/network/http与https的区别.jpg)

那么肯定会有人问这层到底做了什么呢？

![251527236988_.pic](/Users/tang/Desktop/ReadingNotes/image/network/251527236988_.pic.jpg)

从图中我们就能很直接的看出来，主要分为了四个步骤：

1.客户端会生成一个随机数，然后把自己的协议版本，加密方式等发送给服务器

2.服务器会先判断是不是支持协议，是不是有加密方式，如果没有就取消连接了，有的话就生成一个随机数，确认一个加密方式，还有把证书一并发给客户端。

3.客户端收到服务器的相应后，会先校验证书，如果证书不对就会发出警告。如果正确就会生成一个随机数，用证书中所带的服务器公钥进行加密。发送给服务器加密后的随机数，以及告诉服务器之后的信息用协商后的方式加密，也通知服务器握手结束（这里也是前面发送的所有内容的hash值，供服务器校验。）。

4.服务器发送告诉客户端之后的信息用协商后的方式加密，也通知客户端握手结束（这里也是前面发送的所有内容的hash值，供客户端校验。）。

（ps:其实整个过程和TCP的连接方式还蛮像的。）

到这里你可能会问，为什么需要大费周章的做这件事情呢？其实回头想想也是历史的必然。因为之前http请求是明文传输的，想要做监听，拦截，篡改内容等等太容易了，十分不安全所以引入了这一套机制。

#### 2.加密相关

细心的读者在这里肯定发现了很多加密方式，其实在这个过程中主要有2中方式：

1.非对称加密，主要有RSA，其主要特点有有一对密钥公钥与私钥，公钥用与私钥，如果用公钥加密私钥可以解密如果用私钥加密公钥就可以解密，私钥不能泄露。这种加解密比较费时费力。

2.对称加密，主要有DES，其只有一个密钥用于加解密，加解密很迅速。但是因只有个密钥，所以安全性比较差。

其实从图中我们就可以看到其实证书校验那部分用的就是非对称加密。而协商后其实后续用的密钥就是对称加密的密钥。

简单的说**HTTPS是通过一次非对称加密算法进行了协商密钥的生成与交换，然后在后续通信过程中就使用协商密钥进行对称加密通信**这样做的好处也很明显安全，又减少了加解密过程中的损失。

#### 3.证书相关

##### 为什么需要证书？（中间人攻击）

如果没有证书，我没看下下面这种情景:
![261527574381_.pic](/Users/tang/Desktop/ReadingNotes/image/network/261527574381_.pic.jpg)

仔细想想，为什么会出现这个问题？其实最大的原因是我们无法确认双方的身份。**证书的作用就是为了确认通信过程中的身份**。

##### 证书的组成与认证方式

我们以百度的证书为例来看下有哪些东西：

![271527575656_.pic_hd](/Users/tang/Desktop/ReadingNotes/image/network/271527575656_.pic_hd.jpg)

这里我画了很多红框，这些是跟我们认证有直接关系的东西。首先我们这里讲一讲怎么认证

比如这张百度证书其实是有三级的：

![281527576146_.pic](/Users/tang/Desktop/ReadingNotes/image/network/281527576146_.pic.jpg)

其实验证过程也很简单，我先获取第二级的证书这里就是GlobalSign Organization Validation CA - SHA256 - G2获取方式上面也有地址。获取到这个证书拿到其公钥，用这个公钥去验证baidu.com证书的签名，验证通过就说明了baidu.com证书就是GlobalSign Organization Validation CA - SHA256 - G2发布的。而我们客户端一般会预装CA根证书也就是GlobalSign Root CA，所以一层层网上最后一层就是到CA了。默认CA是合法的，所以这一整个证书链就是有效的。而签名里有关于该服务器相关的信息，而且是用上一级私钥加密的，所以中间人就无法伪造了。

这里有一篇阮一峰翻译的[数字签名是什么？](http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html)很形象。

##### 这样真的绝对安全吗？什么情况下不安全？ 抓包工具怎么实现？

其实回头想想这样真的绝对安全吗？不一定。我们前面的机制最后基于CA证书是没问题的。换句话说就是根证书是正确的，但是如果我们信任了一个其他的根证书呢？ 那这样中间人可以获取证书签名里的信息，再自签一次，生成新的证书给客户端，如果客户端信任的它的根证书，那么这个证书也是能验证通过的。而因为签名里的信息就是服务器的信息所以域名校验等也是能通过的。这样就可以达到之前中间人攻击的效果了，其实一些抓包工具像Charles就是这么实现的。

所以说**不要随便信任根证书，这很危险！**

#### 4.https的作用

总结前面的所有的内容，https的作用主要有以下3点？

1.**内容加密**建一个信息安全的通道，来保证数据传输的安全 

2.**身份认证**确认网站的真实性 

3.**数据完整性**校验数据防止内容被第三方冒充或者篡改 

### app如何做到网络安全

